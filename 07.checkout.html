<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/1.Header-Footer/style.css">
    <link rel="icon" href="/Pictures/logo.jpg" type="img/svg">
    <title>Zen Shoes - Checkout</title>
<style>
        /* General Styling */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: #3886e6;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            text-align: center;
            margin: 20px 0;
        }

        .header h1 {
            margin: 0;
        }
        
        .container {
            justify-content: flex-start; /* Align checkout form to the left */
            align-items: flex-start;
            gap: 10px; /* Space between checkout form and order summary */
            padding: 20px;
        }

        .checkout-container {
            width: 50%;
            margin: 100px 500px;
            margin-bottom: -1px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
            color: #001f3f;
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            color: #001f3f;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:hover, select:hover {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.25);
        }

        input:focus, select:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
            outline: none;
        }

        input[type="radio"] {
            width: auto;
            margin-right: 10px;
        }

        .payment-method img {
            margin-left: 10px;
            vertical-align: middle;
        }

        button {
            background-color: #2871bb; /* Navy Blue */
            color: #ffffff; /* White */
            padding: 15px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-transform: uppercase;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #19208a; /* Darker Navy */
        }

        #login {
            text-align: right;
            margin-bottom: 10px;
        }

        #login a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        #login a:hover {
            text-decoration: underline;
        }

        .message {
            margin-top: 20px;
            padding: 15px;
            text-align: center;
            font-size: 1rem;
            border-radius: 5px;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

/* Payment Popup Styling */
.popup-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4); /* Semi-transparent dark overlay */
    backdrop-filter: blur(5px); /* Blurs only the background */
    z-index: 999; /* Behind the popup */
}

/* Popup Container */
.popup-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    text-align: center;
    z-index: 1000; /* Above overlay */
    width: 520px;
    height: 600px;
}

/* Popup Content */
.popup-container h3 {
    margin-bottom: 10px;
    font-size: 20px;
}

.popup-container img {
    margin: 10px 0;
    width: 450px;
    border-radius: 5px;
}

.popup-container p {
    margin-bottom: 10px;
    font-size: 18px;
    color: #333;
}

/* Buttons */
.confirm-payment {
    background: green !important;
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 14px;
}

.confirm-payment:hover {
    background: darkgreen !important;
}

/* Close Button */
.close-popup {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
}

/* Loading Animation */
.loader {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 10px auto;
}

.cancel-btn {
    background-color: red;
    color: white;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease-in-out;
    margin-bottom: 10px;
}

.cancel-btn:hover {
    background-color: darkred;
}

.waiting-btn {
    background-color: #007BFF;
    color: white;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease-in-out;
    margin-bottom: 10px;
}

.waiting-btn:hover {
    background-color: #0056b3;
}

.waiting-btn:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}

.status-icon {
    display: block;
    margin: 0 auto 10px;
    width: 180px;  /* Default size */
    height: auto;
    max-width: 100px;  /* Ensures responsiveness */
}


@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

</style>
</head>

<body>

 <!-- Header -->
 <header class="transparent-header">
    <div class="header-container">
        <a href="01.home.html"> 
        <div class="hlogo">
        <img src="/Pictures/logo.jpg" type="img/svg" alt="Company Logo">
        </div>
        <p id="pp">Zen Store</p></a>  
        <div class="nav-links">
        <a href="/01.home.html">Home</a>
        <div class="product-dropdown">
            <a href="#">Product</a>
            <ul class="product-menu">
                <li><a href="/02.men.html">Men</a></li>
                <li><a href="/02.women.html">Women</a></li>
                <li><a href="/02.sports.html">Sports</a></li>
            </ul>
        </div>
        <a href="/03.cart.html">Cart</a>
        </div>
        <div class="navsym">
            
            <div class="profile-dropdown">
                <a href="/08.profile.html"><i class="fas fa-user"></i></a>
                </ul>
            </div>
        </div>
    </div>
</header>

    <div class="container">
    <div class="checkout-container">
        <div id="login">
            <a href="05.login.html">Login</a>
        </div>
        <form id="checkout-form" action="/submit_checkout" method="POST">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="name">Full Name</label>
                <input type="text" id="name" name="name" placeholder="Enter your full name" required>
            </div>
            <div class="form-group">
                <label for="address">Address</label>
                <input type="text" id="address" name="address" placeholder="Enter your address" required>
            </div>
            <div class="form-group">
                <label for="country">Country</label>
                <select id="country" name="country" required>
                    <option value="pakistan">Pakistan</option>
                </select>
            </div>
            <div class="form-group">
                <label for="city">City</label>
                <select id="city" name="city" required>
                    <option value="" disabled selected>Select your city</option>
                    <option value="Abbottabad">Abbottabad</option>
                    <option value="Attock">Attock</option>
                    <option value="Bahawalpur">Bahawalpur</option>
                    <option value="Bannu">Bannu</option>
                    <option value="Chakwal">Chakwal</option>
                    <option value="Dera Ghazi Khan">Dera Ghazi Khan</option>
                    <option value="Faisalabad">Faisalabad</option>
                    <option value="Gujranwala">Gujranwala</option>
                    <option value="Hyderabad">Hyderabad</option>
                    <option value="Islamabad">Islamabad</option>
                    <option value="Jacobabad">Jacobabad</option>
                    <option value="Karachi">Karachi</option>
                    <option value="Lahore">Lahore</option>
                    <option value="Multan">Multan</option>
                    <option value="Narowal">Narowal</option>
                    <option value="Okara">Okara</option>
                    <option value="Peshawar">Peshawar</option>
                    <option value="Quetta">Quetta</option>
                    <option value="Rawalpindi">Rawalpindi</option>
                    <option value="Sialkot">Sialkot</option>
                    <option value="Tando Adam">Tando Adam</option>
                    <option value="Umerkot">Umerkot</option>
                    <option value="Vehari">Vehari</option>
                    <option value="Wah Cantt">Wah Cantt</option>
                    <option value="Zhob">Zhob</option>
                </select>
            </div>
            <div class="form-group">
                <label for="postal-code">Postal Code (Optional)</label>
                <input type="text" id="postal-code" name="postal-code" placeholder="Enter your postal code">
            </div>
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
            </div>
            <div class="form-group">
                <label>Payment Method</label>
                <div class="payment-method">
                    <label>
                        <input type="radio" name="payment" value="EasyPaisa" required> EasyPaisa
                        <img src="Pictures/Payment Pictures/2.jpg" alt="EasyPaisa" width="20px">
                    </label>
                    <label>
                        <input type="radio" name="payment" value="Cash on Delivery" required> Cash on Delivery
                        <img src="Pictures/Payment Pictures/3.jpg" alt="Cash on Delivery" width="20px">
                    </label>
                </div>
            </div>
            <div class="form-group">
                <button type="submit">Complete Order</button>
                <button type="reset">Reset</button>
            </div>
        </form>
        <div id="message-container"></div>
    </div></div>

    <footer>
        <div class="footer-container">
        <div class="footer-logo">
        </div>
        <div class="footer-info">
        <div class="footer-links">
            <h4>Quick Links</h4>
            <ul>
            <li><a href="/01.home.html">Home</a></li>
            <li><a href="/05.products.html">Products</a></li>
            </ul>
        </div>
        <div class="footer-contact">
            <ul>
            <li>Email: zenstore@gmail.com</li>
            <li>Phone: +92 3145359284</li>
            </ul>
        </div>
        <div class="footer-social">
            <h4>Follow Us</h4>
            <ul>
            <li><a href="https://www.facebook.com/BataHomePK/">Facebook</a></li>
            <li><a href="https://www.instagram.com/batapk/?hl=en">Instagram</a></li>
            <li><a href="admin.html">Instagram</a></li>
            </ul>
        </div>
            <div class="footer-copyright">
            <h5>&copy; 2025 Zen Store. All Rights Reserved.</h5></div>
        </footer>

        <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script> <!-- Pre Loader -->
        <script>

document.addEventListener("DOMContentLoaded", function () {
    const checkoutForm = document.getElementById("checkout-form");

    checkoutForm.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent immediate form submission

        const selectedPayment = document.querySelector("input[name='payment']:checked");

        if (!selectedPayment) {
            alert("Please select a payment method.");
            return;
        }

        if (selectedPayment.value === "EasyPaisa") {
            showEasyPaisaPopup();
            return;
        }

        checkoutForm.submit(); // Submit for Cash on Delivery
    });

    function showEasyPaisaPopup() {
    const existingPopup = document.getElementById("easypaisa-popup");
    if (existingPopup) existingPopup.remove();

    const overlay = document.createElement("div");
    overlay.id = "popup-overlay";
    overlay.classList.add("popup-overlay");

    const popup = document.createElement("div");
    popup.id = "easypaisa-popup";
    popup.classList.add("popup-container");

    // Retrieve the total price from localStorage
    const totalPrice = localStorage.getItem("totalPrice");

    popup.innerHTML = `
        <button class="close-popup">&times;</button>
        <div class="popup-content">
            <h3>Complete Your Payment</h3>
            <img src="Pictures/Payment Pictures/easy.jpg" alt="EasyPaisa Payment">
            <p><strong>Account Number:</strong> 03155298580</p><br>
            <p><strong>Total Amount:</strong> PKR ${totalPrice}</p><br> <!-- Display total price here -->
            <p>After making the payment, click "Payment Completed".</p><br> 
            <button id="confirm-payment">Payment Completed</button>
        </div>
    `;

    document.body.appendChild(overlay);
    document.body.appendChild(popup);

    document.querySelector(".close-popup").addEventListener("click", closePopup);

    document.getElementById("confirm-payment").addEventListener("click", function () {
        processPayment();
    });
}


    function processPayment() {
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const paymentMethod = "EasyPaisa";

    if (!name || !email) {
        alert("Please enter your name and email before proceeding.");
        return;
    }

    let orderCount = parseInt(localStorage.getItem("orderCount")) || 0;
    orderCount += 1; // ✅ Ensure count increments only once
    localStorage.setItem("orderCount", orderCount); // ✅ Save updated order count

    const orderDetails = {
        orderNumber: orderCount,
        name: name,
        email: email,
        paymentMethod: paymentMethod,
        status: "Pending"
    };

    // ✅ FIX: Check if the order already exists before adding
    let orders = JSON.parse(localStorage.getItem("orders")) || [];
    
    const existingOrder = orders.find(order => order.orderNumber === orderCount);
    if (!existingOrder) {
        orders.push(orderDetails); // ✅ Add order only if it’s new
        localStorage.setItem("orders", JSON.stringify(orders)); // ✅ Save orders
    }

    // ✅ Store latest order separately for admin to fetch
    localStorage.setItem("latestOrder", JSON.stringify(orderDetails));

    showProcessingPopup(orderCount);
}

function showProcessingPopup(orderNumber) {
    const popup = document.getElementById("easypaisa-popup");
    if (popup) {
        const isAdminAvailable = localStorage.getItem("adminOnline") === "true"; // ✅ Check if admin is online

        popup.innerHTML = `
            <div class="popup-content">
                <div class="loader"></div>
                <p>Payment Processing... Please wait.</p>
                <p>${isAdminAvailable ? "A representative is available. Your order will be reviewed shortly." : "No representative is online. If no response is received within a few minutes, expect a decision within 24 hours."}</p>
                <button id="waiting-btn" class="waiting-btn">OK, I'm Waiting</button> <!-- ✅ New Button -->
                <button id="cancel-payment" class="cancel-btn">Cancel Payment</button>
            </div>
        `;

        document.getElementById("cancel-payment").addEventListener("click", cancelPayment);

        document.getElementById("waiting-btn").addEventListener("click", function () {
            closePopup(); // ✅ Close the popup
            addTrackOrderButton(orderNumber); // ✅ Show "Track Your Order" Button
        });
    }

    const startTime = Date.now();
    const timeoutDuration = 60000 * 5; // 5-minute timeout

    const interval = setInterval(() => {
        const latestStatus = JSON.parse(localStorage.getItem("latestOrderStatus"));

        if (latestStatus && latestStatus.orderNumber === orderNumber && latestStatus.status !== "Pending") {
            clearInterval(interval);
            showFinalPaymentStatus(latestStatus.status);
        }

        if (Date.now() - startTime > timeoutDuration) {
            clearInterval(interval);
            showFinalPaymentStatus("Rejected");
        }
    }, 2000);
}

function cancelPayment() {
    closePopup(); // ✅ Close popup immediately
    localStorage.removeItem("latestOrder"); // ✅ Prevent sending to admin
    alert("Payment process has been canceled.");
}


function showFinalPaymentStatus(status) {
    const popup = document.getElementById("easypaisa-popup");
    if (popup) {
        popup.innerHTML = ` 
            <div class="popup-content ${status === "Accepted" ? "success" : "failed"}">
                <img src="${status === "Accepted" ? "/SVG/tick.svg" : "/SVG/cross.svg"}" 
                    class="status-icon" alt="Payment ${status}" />
                <h2>${status === "Accepted" ? "Payment Successful!" : "Payment Unsuccessful"}</h2>
                <p>${status === "Accepted" ? "Your payment has been approved." : "Your payment was rejected."}</p>
                <button id="ok-btn">OK</button>
            </div>
        `;

        document.getElementById("ok-btn").addEventListener("click", function () {
            closePopup();
            if (status === "Accepted") {
                window.location.href = "thankyou.html"; // Redirect to thankyou.html on successful payment
            }
        });
    }
}

function closePopup() {
    const popup = document.getElementById("easypaisa-popup");
    const overlay = document.getElementById("popup-overlay");
    
    if (popup) popup.remove();
    if (overlay) overlay.remove();
}

});

document.addEventListener("DOMContentLoaded", function () {
    const loginLink = document.getElementById("login");
    const checkoutForm = document.getElementById("checkout-form");
    
    // Retrieve stored login details
    const storedEmail = localStorage.getItem("userEmail");
    
    if (storedEmail) {
        // User is logged in, hide login link
        loginLink.style.display = "none";
    } else {
        // User is not logged in, prevent checkout
        checkoutForm.addEventListener("submit", function (event) {
            event.preventDefault();
            alert("You have to login first");
            window.location.href = "05.login.html"; // Redirect to login page
        });
    }
});
document.addEventListener("DOMContentLoaded", function () {
        const emailInput = document.getElementById("email");
        const phoneInput = document.getElementById("phone");
        const checkoutForm = document.getElementById("checkout-form");
        
        function saveFormData() {
            localStorage.setItem("checkoutEmail", emailInput.value);
            localStorage.setItem("checkoutPhone", phoneInput.value);
        }
        
        function restoreFormData() {
            if (localStorage.getItem("checkoutEmail")) {
                emailInput.value = localStorage.getItem("checkoutEmail");
            }
            if (localStorage.getItem("checkoutPhone")) {
                phoneInput.value = localStorage.getItem("checkoutPhone");
            }
        }
        
        function showPopup(message) {
            saveFormData();
            if (confirm(message)) {
                window.location.href = "07.checkout.html";
            }
        }
        
        function validateEmail() {
            const emailValue = emailInput.value.trim();
            return emailValue.endsWith("@gmail.com");
        }
        
        function validatePhone() {
            const phoneValue = phoneInput.value.trim();
            return /^\d{11}$/.test(phoneValue);
        }
        
        checkoutForm.addEventListener("submit", function (event) {
            if (!localStorage.getItem("userEmail")) {
                showPopup("You must log in first!");
                window.location.href = "05.login.html";
                event.preventDefault();
                return;
            }
            
            if (!validateEmail()) {
                showPopup("Email must end with @gmail.com!");
                event.preventDefault();
                return;
            }
            
            if (!validatePhone()) {
                showPopup("Phone number must be exactly 11 digits!");
                event.preventDefault();
                return;
            }
        });
        
        restoreFormData();
    });


        </script>

</body>
</html>
